---
title: "Association of chronic pain and depression with brain structure"
author: "Hannah Casey"
date: "6/17/2022"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.width=12, fig.height=12)
# Read in relevant R packages
library(tidyverse)
library(grid)
library(kableExtra)
library(plotly)
library(wesanderson)
library(ggrepel)
library(ggforce)
library(ggseg)
library(patchwork)
library(RColorBrewer)
# Include width and height for figures in the knitr::opts_chunk$set code above
```

**Pre-processing and QC - brain structure data:**

- Outliers removed (>5 SD)

- Global DTI measures calculated using PCA

----------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------

### Associations between DNAm scores and brain structure data

----------------------------------------------------------------------------------------------------------------------------
Models:

- GLM for unilatearal brain phenotypes
- LME for bilateral brain phenotypes where measures of hemisphere were treated as repeated measures
  - No hemishphere interactions on association between DNAm score and bilateral phenotype observed
  
Covariates: 
- Sex
- Age
- Age^2 
- BMI
- UKB imaging assessment centre
- ICV (only for measures of brain volume)

Multiple comparision correction: FDR
  - n = number of brain structure phenotypes per imaging subcategory

```{r Load in and format data, echo=FALSE,  fig.height=50}
# Read in results 
res_CP_MDD_brain_structure_all <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc.csv",header=T)
res_CP_MDD_brain_structure_all$sample <- "All"

res_CP_MDD_brain_structure_female <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc_females.csv",header=T)
res_CP_MDD_brain_structure_female$sample <- "Female"

res_CP_MDD_brain_structure_male <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc_males.csv",header=T)
res_CP_MDD_brain_structure_male$sample <- "Male"


res_CP_MDD_brain_structure_female_site <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc_females_site.csv",header=T)
res_CP_MDD_brain_structure_female_site$sample <- "Female"

res_CP_MDD_brain_structure_male_site <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc_males_site.csv",header=T)
res_CP_MDD_brain_structure_male_site$sample <- "Male"


res_comorbidity_brain_structure_all <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_comorbidity_structure_assoc.csv")
load("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/n.Rdata")
res_comorbidity_brain_structure_all$sample <- "All"

res_comorbidity_brain_structure_female <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_comorbidity_structure_assoc_females.csv")
res_comorbidity_brain_structure_female$sample <- "Female"

res_comorbidity_brain_structure_male <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_comorbidity_structure_assoc_males.csv")
res_comorbidity_brain_structure_male$sample <- "Male"

## Combine results into single dataframes
res_CP_MDD_brain_structure <- rbind(res_CP_MDD_brain_structure_all, res_CP_MDD_brain_structure_female, res_CP_MDD_brain_structure_male)

res_CP_MDD_brain_structure_sex_site <- rbind(res_CP_MDD_brain_structure_female_site, res_CP_MDD_brain_structure_male_site)


res_comorbidity_brain_structure <- rbind(res_comorbidity_brain_structure_all, res_comorbidity_brain_structure_female, res_comorbidity_brain_structure_male)

## Create new columns to reformat brain phenotypes for plotting
res_CP_MDD_brain_structure$brain_phenotype_plot <-  gsub("MD", "MD in", res_CP_MDD_brain_structure$brain_phenotype)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("FA", "FA in", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("volume", "Volume of", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("area", "Area of", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("_", " ", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_structure_type_plot <- gsub("_", " ", res_CP_MDD_brain_structure$brain_structure_type)


res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <-  gsub("MD", "MD in", res_CP_MDD_brain_structure_sex_site$brain_phenotype)
res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <- gsub("FA", "FA in", res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot)
res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <- gsub("volume", "Volume of", res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot)
res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <- gsub("area", "Area of", res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot)
res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot)
res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot)
res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot <- gsub("_", " ", res_CP_MDD_brain_structure_sex_site$brain_phenotype_plot)
res_CP_MDD_brain_structure_sex_site$brain_structure_type_plot <- gsub("_", " ", res_CP_MDD_brain_structure_sex_site$brain_structure_type)


res_comorbidity_brain_structure$brain_phenotype_plot <-  gsub("MD", "MD in", res_comorbidity_brain_structure$X)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("FA", "FA in", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("volume", "Volume of", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("area", "Area of", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("\\.[1-9]", "", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("_", " ", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_structure_type_plot <- gsub("_", " ", res_comorbidity_brain_structure$brain_structure_type)

## Add correct spacing to corical region measurent plot names



## Reorder brain phenotype and subgroups for plotting
res_CP_MDD_brain_structure$brain_structure_type_plot  <- ordered(res_CP_MDD_brain_structure$brain_structure_type_plot , levels = c("Subcortical Volumes", "Cortical Regional Volumes","Cortical Volume Global and Lobal Measures", "Cortical Regional areas", "Cortical area Global and Lobal Measures", "Cortical Regional Thickness","Cortical thickness Global and Lobal Measures", "FA Tracts", "MD Tracts","FA General Measures", "MD General Measures"))

res_comorbidity_brain_structure$brain_structure_type_plot  <- ordered(res_comorbidity_brain_structure$brain_structure_type_plot , levels = c("Subcortical Volumes", "Cortical Regional Volumes","Cortical Volume Global and Lobal Measures", "Cortical Regional areas", "Cortical area Global and Lobal Measures", "Cortical Regional Thickness","Cortical thickness Global and Lobal Measures", "FA Tracts", "MD Tracts","FA General Measures", "MD General Measures"))

# Include yes/no column to determine shape based on p-value
res_CP_MDD_brain_structure$`Adjusted p-value` = ifelse(res_CP_MDD_brain_structure$p.adjust < 0.05, "Yes","No")

# Keep results comparing comorbid groups to those with no pain or depression
res_comorbidity_brain_structure <- res_comorbidity_brain_structure[res_comorbidity_brain_structure$groups == "(No Probable Recurrent MDD + No Chronic Pain) - (No Probable Recurrent MDD + Chronic Pain)" | res_comorbidity_brain_structure$groups == "(No Probable Recurrent MDD + No Chronic Pain) - (Probable Recurrent MDD + Chronic Pain)" | res_comorbidity_brain_structure$groups == "(No Probable Recurrent MDD + No Chronic Pain) - (Probable Recurrent MDD + No Chronic Pain)",]

## Rename comorbidity groups for simplicity
res_comorbidity_brain_structure$groups[res_comorbidity_brain_structure$groups == "(No Probable Recurrent MDD + No Chronic Pain) - (No Probable Recurrent MDD + Chronic Pain)"] <- "CP+MDD-"
res_comorbidity_brain_structure$groups[res_comorbidity_brain_structure$groups == "(No Probable Recurrent MDD + No Chronic Pain) - (Probable Recurrent MDD + No Chronic Pain)"] <- "CP-MDD+"
res_comorbidity_brain_structure$groups[res_comorbidity_brain_structure$groups == "(No Probable Recurrent MDD + No Chronic Pain) - (Probable Recurrent MDD + Chronic Pain)"] <- "CP+MDD+"

## Add column indicating which resutls are statitically significant
res_comorbidity_brain_structure$significant <- ifelse(res_comorbidity_brain_structure$p.adjust < 0.05,"Yes" , "No")

## Add column indicating if results are psiitvie or negative (will be used in p-value graph later)
res_CP_MDD_brain_structure$Direction <- ifelse(sign(res_CP_MDD_brain_structure$beta) < 1,"Negative" , "Positive")

## Remove small dfs to clean up environment
rm(res_CP_MDD_brain_structure_all)
rm(res_CP_MDD_brain_structure_female)
rm(res_CP_MDD_brain_structure_male)
rm(res_comorbidity_brain_structure_all)
rm(res_comorbidity_brain_structure_male)
rm(res_comorbidity_brain_structure_female)

```

### Number of UKB participants with full data

----------------------------------------------------------------------------------------------------------------------------

```{r}
(list_df)
```


#### Results - Brain structures {.tabset}

##### Effect size graph - Chronic pain status in full sample
```{r Effect size graph chronic pain status - full sample, echo=FALSE,  fig.height=50}
brain_structure_CP_all <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$disorder == "chronic_pain") & res_CP_MDD_brain_structure$sample == "All",]

## Order levels of brain phenotpyes in oder of beta values to make plot neat
brain_structure_CP_all$brain_phenotype_plot <- reorder(brain_structure_CP_all$brain_phenotype_plot, -brain_structure_CP_all$beta)

## Get colour palette
pal <- wes_palette("Zissou1", 100, type = "continuous")

## Plot resutls
brain_structure_gg = ggplot(brain_structure_CP_all, aes(x=brain_phenotype_plot, y=beta, shape=`Adjusted p-value`)) + 
  geom_point(aes(y=beta),size=2) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  scale_colour_gradientn(colours = pal) +
  labs(x = "Brain Structure Phenotype", 
       y = "Standardised effect size", 
       title = "Chronic pain and brain structures in UK Biobank",
       colour = "Nominal P-value",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg

```

##### Effect size graph - Chronic pain status in sex-stratified samples
```{r Effect size graph chronic pain status - sex-stratified samples, echo=FALSE,  fig.height=50}
brain_structure_CP_sex_stratified <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$disorder == "chronic_pain") & (res_CP_MDD_brain_structure$sample == "Female" | res_CP_MDD_brain_structure$sample == "Male"),]

## Order levels of brain phenotpyes in oder of beta values to make plot neat
brain_structure_CP_sex_stratified$brain_phenotype_plot <- reorder(brain_structure_CP_sex_stratified$brain_phenotype_plot, -brain_structure_CP_sex_stratified$beta)

## Create discrete colour palette
pal1 <- wes_palette("Darjeeling1",3, type = "discrete")

## Plot resutls
brain_structure_gg = ggplot(brain_structure_CP_sex_stratified, aes(x=brain_phenotype_plot, y=beta, shape=`Adjusted p-value`,colour=sample)) + 
  geom_point(aes(y=beta),size=3, alpha = 0.5) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0, alpha = 0.5) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  labs(x = "", 
       y = "Standardised effect size", 
       title = "Chronic pain and brain structures in UK Biobank: sex-stratified",
       colour = "Sex",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = pal1) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg
```

##### Effect size graph - Chronic pain status in sex and site-stratified samples
```{r Effect size graph chronic pain status - sex and site-stratified samples, echo=FALSE,  fig.height=50}
brain_structure_CP_sex_stratified <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$disorder == "chronic_pain") & (res_CP_MDD_brain_structure$sample == "Female" | res_CP_MDD_brain_structure$sample == "Male"),]

## Order levels of brain phenotpyes in oder of beta values to make plot neat
brain_structure_CP_sex_stratified$brain_phenotype_plot <- reorder(brain_structure_CP_sex_stratified$brain_phenotype_plot, -brain_structure_CP_sex_stratified$beta)

## Create discrete colour palette
pal1 <- wes_palette("Darjeeling1",3, type = "discrete")

## Plot resutls
brain_structure_gg = ggplot(brain_structure_CP_sex_stratified, aes(x=brain_phenotype_plot, y=beta, shape=`Adjusted p-value`,colour=sample)) + 
  geom_point(aes(y=beta),size=3, alpha = 0.5) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0, alpha = 0.5) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  labs(x = "", 
       y = "Standardised effect size", 
       title = "Chronic pain and brain structures in UK Biobank: sex-stratified",
       colour = "Sex",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = pal1) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg
```


##### Effect size graph - Probable Recurrent Major Depressive Disorder in full smaple

```{r Effect size graph MDD - full sample, echo=FALSE,  fig.height=50}
brain_structure_MDD_all <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$disorder == "recurrent_depression") & res_CP_MDD_brain_structure$sample == "All",]

## Order levels of brain phenotpyes in oder of beta values to make plot neat
brain_structure_MDD_all$brain_phenotype_plot <- reorder(brain_structure_MDD_all$brain_phenotype_plot, -brain_structure_MDD_all$beta)

brain_structure_gg = ggplot(brain_structure_MDD_all, aes(x=brain_phenotype_plot, y=beta, shape=`Adjusted p-value`)) + 
  geom_point(size=2) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  scale_colour_gradientn(colours = pal) +
  labs(x = "Brain Structure Phenotype", 
       y = "Standardised effect size", 
       title = "Major depressive disorder and brain structures in UK Biobank",
       colour = "Nominal P-value",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5))  +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")
  
brain_structure_gg

```

##### Effect size graph - Probable Recurrent Major Depressive Disorder in sex-stratified sample

```{r Effect size graph MDD - sex-stratified sample, echo=FALSE,  fig.height=50}

brain_structure_MDD_sex_stratified <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure$sample == "Female" | res_CP_MDD_brain_structure$sample == "Male"),]

## Order levels of brain phenotpyes in oder of beta values to make plot neat
brain_structure_MDD_sex_stratified$brain_phenotype_plot <- reorder(brain_structure_MDD_sex_stratified$brain_phenotype_plot, -brain_structure_MDD_sex_stratified$beta)

## Create discrete colour palette
pal1 <- wes_palette("Darjeeling1",3, type = "discrete")

## Plot resutls
brain_structure_gg = ggplot(brain_structure_MDD_sex_stratified, aes(x=brain_phenotype_plot, y=beta, shape=`Adjusted p-value`,colour=sample)) + 
  geom_point(aes(y=beta),size=3, alpha = 0.5) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0, alpha = 0.5) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  labs(x = "", 
       y = "Standardised effect size", 
       title = "Depression and brain structures in UK Biobank: sex-stratified",
       colour = "Sex",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = pal1) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg

```


##### Effect size graph - Comorbidity in full sample 

```{r Effect size graph Comorbidity - full sample, fig.height= 25, echo=FALSE}

res_comorbidity_brain_structure_all <- res_comorbidity_brain_structure[(res_comorbidity_brain_structure$sample == "All") ,]


## Create discrete colour palette
pal1 <- wes_palette("Darjeeling1",3, type = "discrete")

## Plot resutls
brain_structure_gg = ggplot(res_comorbidity_brain_structure_all, aes(x=brain_phenotype_plot, y=beta, shape=significant,colour=as.factor(groups))) + 
  geom_point(aes(y=beta),size=3, alpha = 0.5) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0, alpha = 0.5) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  labs(x = "", 
       y = "Standardised effect size", 
       title = "Chronic pain and depression and brain structures in UK Biobank",
       colour = "Comorbidity Group",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = pal1) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg

```

##### Effect size graph - Comorbidity in female sample

```{r Effect size graph Comorbidity - female sample, fig.height= 25, echo=FALSE}

res_comorbidity_brain_structure_female <- res_comorbidity_brain_structure[(res_comorbidity_brain_structure$sample == "Female") ,]

## Plot resutls
brain_structure_gg = ggplot(res_comorbidity_brain_structure_female, aes(x=brain_phenotype_plot, y=beta, shape=significant,colour=as.factor(groups))) + 
  geom_point(aes(y=beta),size=3, alpha = 0.5) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0, alpha = 0.5) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  labs(x = "", 
       y = "Standardised effect size", 
       title = "Chronic pain and depression and brain structures in UK Biobank: female sample",
       colour = "Comorbidity Group",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = pal1) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg

```

##### Effect size graph - Comorbidity in male sample

```{r Effect size graph Comorbidity - male sample, fig.height= 25, echo=FALSE}

res_comorbidity_brain_structure_male <- res_comorbidity_brain_structure[(res_comorbidity_brain_structure$sample == "Male") ,]

## Plot resutls
brain_structure_gg = ggplot(res_comorbidity_brain_structure_male, aes(x=brain_phenotype_plot, y=beta, shape=significant,colour=as.factor(groups))) + 
  geom_point(aes(y=beta),size=3, alpha = 0.5) +
  geom_errorbar(aes(ymin=Lower_95CI, ymax=Upper_95CI), width=0, alpha = 0.5) +
  theme_minimal() +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  coord_flip() +
  labs(x = "", 
       y = "Standardised effect size", 
       title = "Chronic pain and depression and brain structures in UK Biobank: male sample",
       colour = "Comorbidity Group",
       shape = "Significance") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_color_manual(values = pal1) +
  ggforce::facet_col(facets = vars(brain_structure_type_plot), 
                     scales = "free_y", 
                     space = "free")

brain_structure_gg

```


##### P-value graph - Depression - full sample

```{r P-value graph MDD - full sample, echo=FALSE, fig.height=10}

pal2 <- wes_palette("Darjeeling1", 11,type = "continuous")

## Transform p.adjsut to use as y-axis
brain_structure_MDD_all$p.adjust.minus.log <- -log10(brain_structure_MDD_all$p.adjust)

ggplot(brain_structure_MDD_all, aes(x = brain_structure_type_plot, y = p.adjust.minus.log, colour =  brain_structure_type_plot, shape = Direction, stroke = 1, fill = `Adjusted p-value`)) +
  scale_shape_manual(values=c(25, 24)) + 
  scale_fill_manual(values = c("white", "dark grey")) +
  geom_jitter(size = 2, position = position_jitter(seed = 151097)) +
    geom_hline(yintercept=-log10(0.05), linetype="dashed", 
               color = "red", size=1, alpha = 0.4) +
  geom_label_repel(aes(label = ifelse(p.adjust < 0.05,as.character(brain_phenotype_plot),'')),
                  box.padding   = 0.5, 
                  size = 3,
                  point.padding = 0,
                  segment.color = 'grey50',
                  position = position_jitter(seed = 151097),
                  max.overlaps = 100,
                  fill = "white",
                  show.legend = FALSE) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1), axis.text.y=element_blank()) +
  xlab("") + ylab("-log10(p)") +
  scale_color_manual(values = pal2) + 
  guides(fill=guide_legend(override.aes=list(shape=21)), colour=guide_legend(title = "Brain Strucutre Subcategory"))


```

##### P-value graph - Depression - sex-stratified sample

```{r P-value graph MDD - male sample, echo=FALSE, fig.height=10}

brain_structure_MDD_male <- brain_structure_MDD_sex_stratified[brain_structure_MDD_sex_stratified$sample == "Male",]
brain_structure_MDD_female <- brain_structure_MDD_sex_stratified[brain_structure_MDD_sex_stratified$sample == "Female",]


## Transform p.adjsut to use as y-axis
brain_structure_MDD_male$p.adjust.minus.log <- -log10(brain_structure_MDD_male$p.adjust)
brain_structure_MDD_female$p.adjust.minus.log <- -log10(brain_structure_MDD_female$p.adjust)


plot_depression_females <- ggplot(brain_structure_MDD_female, aes(x = brain_structure_type_plot, y = p.adjust.minus.log, colour =  brain_structure_type_plot, shape = Direction, stroke = 1, fill = `Adjusted p-value`)) +
  scale_shape_manual(values=c(25, 24)) + 
  scale_fill_manual(values = c("white", "dark grey")) +
  geom_jitter(size = 2, position = position_jitter(seed = 151097)) +
  geom_hline(yintercept=-log10(0.05), linetype="dashed", 
               color = "red", size=1, alpha = 0.4) +
  geom_label_repel(aes(label = ifelse(p.adjust < 0.05,as.character(brain_phenotype_plot),'')),
                  size = 3,
                  box.padding   = 0.5, 
                  point.padding = 0,
                  segment.color = 'grey50',
                  position = position_jitter(seed = 151097),
                  max.overlaps = 100,
                  fill = "white",
                  show.legend = FALSE) +
  theme_classic() +
  ylim(c(0,(max(brain_structure_MDD_female$p.adjust.minus.log) + 1))) +
  theme(axis.text.x = element_blank()) +
  xlab("") + ylab("-log10(p)") +
  scale_color_manual(values = pal2) + 
  guides(fill=guide_legend(override.aes=list(shape=21)), colour=guide_legend(title = "Brain Strucutre Subcategory"))



plot_depression_males <- ggplot(brain_structure_MDD_male, aes(x = brain_structure_type_plot, y = p.adjust.minus.log, colour =  brain_structure_type_plot, shape = Direction, stroke = 1, fill = `Adjusted p-value`)) +
  scale_shape_manual(values=c(25, 24)) + 
  scale_fill_manual(values = c("white", "dark grey")) +
  geom_jitter(size = 2, position = position_jitter(seed = 151097)) +
  geom_hline(yintercept=-log10(0.05), linetype="dashed", 
               color = "red", size=1, alpha = 0.4) +
  geom_label_repel(aes(label = ifelse(p.adjust < 0.05,as.character(brain_phenotype_plot),'')),
                  box.padding   = 0.5, 
                  size = 3,
                  point.padding = 0,
                  segment.color = 'grey50',
                  position = position_jitter(seed = 151097),
                  max.overlaps = 100,
                  fill = "white",
                  show.legend = FALSE)  +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab("") + ylab("-log10(p)") +
  scale_color_manual(values = pal2) +
  scale_y_reverse(limits = c((max(brain_structure_MDD_female$p.adjust.minus.log) + 1),0)) +
  scale_x_discrete(position = "top") 

# arrange the three plots in a single row
prow <- cowplot::plot_grid(
  plot_depression_females + theme(legend.position="none"),
  plot_depression_males + theme(legend.position="none"),
  ncol = 1.,
  rel_heights = c(1,1.2))

# extract the legend from one of the plots
legend <- cowplot::get_legend(plot_depression_females+ theme(legend.box.margin = margin(150, 0, 0, 50)))

# add the legend to the row we made earlier. Give it one-third of 
# the width of one plot (via rel_widths).
cowplot::plot_grid(prow, legend, rel_widths = c(3, .4))
```

##### P-value graph - Chronic Pain Status - full sample

```{r P-value graph chronic pain status - full sample, echo=FALSE, fig.height=10}
brain_structure_CP_all$p.adjust.minus.log <- -log10(brain_structure_CP_all$p.adjust)


ggplot(brain_structure_CP_all, aes(x = brain_structure_type_plot, y = p.adjust.minus.log, colour =  brain_structure_type_plot, shape = Direction, stroke = 1, fill = `Adjusted p-value`)) +
  scale_shape_manual(values=c(25, 24)) + 
  scale_fill_manual(values = c("white", "dark grey")) +
  geom_jitter(size = 2, position = position_jitter(seed = 151097)) +
  geom_hline(yintercept=-log10(0.05), linetype="dashed", 
               color = "red", size=1, alpha = 0.4) +
  geom_label_repel(aes(label = ifelse(p.adjust < 0.05,as.character(brain_phenotype_plot),'')),
                  size = 2,
                  box.padding   = 1, 
                  point.padding = 0,
                  segment.color = 'grey50',
                  position = position_jitter(seed = 151097),
                  max.overlaps = 100,
                  fill = "white",
                  show.legend = FALSE) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1), axis.text.y=element_blank()) +
  xlab("") + ylab("-log10(p)") +
  scale_color_manual(values = pal2) + 
  guides(fill=guide_legend(override.aes=list(shape=21)), colour=guide_legend(title = "Brain Strucutre Subcategory"))
```


##### P-value graph - Chronic Pain - sex-stratified sample

```{r P-value graph Chronic Pain - male sample, echo=FALSE, fig.height=10}

brain_structure_CP_male <- brain_structure_CP_sex_stratified[brain_structure_CP_sex_stratified$sample == "Male",]
brain_structure_CP_female <- brain_structure_CP_sex_stratified[brain_structure_CP_sex_stratified$sample == "Female",]


## Transform p.adjsut to use as y-axis
brain_structure_CP_male$p.adjust.minus.log <- -log10(brain_structure_CP_male$p.adjust)
brain_structure_CP_female$p.adjust.minus.log <- -log10(brain_structure_CP_female$p.adjust)


plot_CP_females <- ggplot(brain_structure_CP_female, aes(x = brain_structure_type_plot, y = p.adjust.minus.log, colour =  brain_structure_type_plot, shape = Direction, stroke = 1, fill = `Adjusted p-value`)) +
  scale_shape_manual(values=c(25, 24)) + 
  scale_fill_manual(values = c("white", "dark grey")) +
  geom_jitter(size = 2, position = position_jitter(seed = 151097)) +
  geom_hline(yintercept=-log10(0.05), linetype="dashed", 
               color = "red", size=1, alpha = 0.4) +
  geom_label_repel(aes(label = ifelse(p.adjust < 0.05,as.character(brain_phenotype_plot),'')),
                  size = 3,
                  box.padding   = 0.5, 
                  point.padding = 0,
                  segment.color = 'grey50',
                  position = position_jitter(seed = 151097),
                  max.overlaps = 100,
                  fill = "white",
                  show.legend = FALSE) +
  theme_classic() +
  ylim(c(0,(max(brain_structure_CP_female$p.adjust.minus.log) + 1))) +
  theme(axis.text.x = element_blank()) +
  xlab("") + ylab("-log10(p)") +
  scale_color_manual(values = pal2) + 
  guides(fill=guide_legend(override.aes=list(shape=21)), colour=guide_legend(title = "Brain Strucutre Subcategory"))



plot_CP_males <- ggplot(brain_structure_CP_male, aes(x = brain_structure_type_plot, y = p.adjust.minus.log, colour =  brain_structure_type_plot, shape = Direction, stroke = 1, fill = `Adjusted p-value`)) +
  scale_shape_manual(values=c(25, 24)) + 
  scale_fill_manual(values = c("white", "dark grey")) +
  geom_jitter(size = 2, position = position_jitter(seed = 151097)) +
  geom_hline(yintercept=-log10(0.05), linetype="dashed", 
               color = "red", size=1, alpha = 0.4) +
  geom_label_repel(aes(label = ifelse(p.adjust < 0.05,as.character(brain_phenotype_plot),'')),
                  box.padding   = 0.5, 
                  size = 3,
                  point.padding = 0,
                  segment.color = 'grey50',
                  position = position_jitter(seed = 151097),
                  max.overlaps = 100,
                  fill = "white",
                  show.legend = FALSE)  +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  xlab("") + ylab("-log10(p)") +
  scale_color_manual(values = pal2) +
  scale_y_reverse(limits = c((max(brain_structure_CP_female$p.adjust.minus.log) + 1),0)) +
  scale_x_discrete(position = "top") 

# arrange the three plots in a single row
prow <- cowplot::plot_grid(
  plot_CP_females + theme(legend.position="none"),
  plot_CP_males + theme(legend.position="none"),
  ncol = 1,
  rel_heights = c(1,1.2))

# extract the legend from one of the plots
legend <- cowplot::get_legend(plot_CP_females+ theme(legend.box.margin = margin(150, 0, 0, 50)))

# add the legend to the row we made earlier. Give it one-third of 
# the width of one plot (via rel_widths).
cowplot::plot_grid(prow, legend, rel_widths = c(3, .4))
```


##### Cortex volume map

```{r Cortex volume chronic pain status, echo = FALSE}

## Get only regional cortical volumes in chronic pain 
res_CP_MDD_brain_structure_regional_cortical_volumes <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$brain_structure_type == "Cortical_Regional Volumes") & (res_CP_MDD_brain_structure$disorder == "chronic_pain" | res_CP_MDD_brain_structure$disorder == "recurrent_depression"),]

dk_cortical_regions <- dk$palette

## Remove "corpus callosum" and "temporal pole" as they are not availalbe on UKB
dk_cortical_regions <- names(dk_cortical_regions)[!names(dk_cortical_regions) %in% c("corpus callosum", "temporal pole")]
res_CP_MDD_brain_structure_regional_cortical_volumes$regions_ggseg <- rep(dk_cortical_regions, 6)

## Compare name columns as sanity check
#res_CP_MDD_brain_structure_regional_cortical_volumes[c("regions_ggseg", "brain_phenotype")]

## Create informative groups
res_CP_MDD_brain_structure_regional_cortical_volumes$group[(res_CP_MDD_brain_structure_regional_cortical_volumes$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_volumes$sample == "All")] <- "Chronic Pain: Full Sample"

res_CP_MDD_brain_structure_regional_cortical_volumes$group[(res_CP_MDD_brain_structure_regional_cortical_volumes$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_volumes$sample == "Female")] <- "Chronic Pain: Female Sample"

res_CP_MDD_brain_structure_regional_cortical_volumes$group[(res_CP_MDD_brain_structure_regional_cortical_volumes$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_volumes$sample == "Male")] <- "Chronic Pain: Male Sample"

res_CP_MDD_brain_structure_regional_cortical_volumes$group[(res_CP_MDD_brain_structure_regional_cortical_volumes$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_volumes$sample == "All")] <- "Depression: Full Sample"

res_CP_MDD_brain_structure_regional_cortical_volumes$group[(res_CP_MDD_brain_structure_regional_cortical_volumes$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_volumes$sample == "Female")] <- "Depression: Female Sample"

res_CP_MDD_brain_structure_regional_cortical_volumes$group[(res_CP_MDD_brain_structure_regional_cortical_volumes$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_volumes$sample == "Male")] <- "Depression: Male Sample"


regional_cortical_volumes_ggseg <- tibble(
  region = res_CP_MDD_brain_structure_regional_cortical_volumes$regions_ggseg, 
  "Standardized β" = res_CP_MDD_brain_structure_regional_cortical_volumes$beta,
  groups = res_CP_MDD_brain_structure_regional_cortical_volumes$group
)

## Order groups
regional_cortical_volumes_ggseg$groups <- ordered(regional_cortical_volumes_ggseg$groups, levels = c("Chronic Pain: Full Sample", "Chronic Pain: Female Sample", "Chronic Pain: Male Sample", "Depression: Full Sample", "Depression: Female Sample", "Depression: Male Sample"))

ggplot() +
  geom_brain(atlas = dk,
  hemi = "right") +  
   scale_fill_brain2(wes_palette("Darjeeling1",35,type = "continuous")) +
  theme_minimal()

regional_cortical_volumes_ggseg %>%
  group_by(groups) %>%
  ggplot() +
  geom_brain(atlas = dk, 
             hemi = "right",
             aes(fill = `Standardized β`)) +
  facet_wrap(~groups) +
  scale_fill_gradient2(low = 'blue', mid = 'white', high = 'red') +
  theme_minimal() 

```


##### Cortex area map

```{r Cortex area chronic pain status, echo = FALSE}

## Get only regional cortical areas in chronic pain 
res_CP_MDD_brain_structure_regional_cortical_areas <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$brain_structure_type == "Cortical_Regional areas") & (res_CP_MDD_brain_structure$disorder == "chronic_pain" | res_CP_MDD_brain_structure$disorder == "recurrent_depression"),]

dk_cortical_regions <- dk$palette

## Remove "corpus callosum" and "temporal pole" as they are not availalbe on UKB
dk_cortical_regions <- names(dk_cortical_regions)[!names(dk_cortical_regions) %in% c("corpus callosum", "temporal pole")]
res_CP_MDD_brain_structure_regional_cortical_areas$regions_ggseg <- rep(dk_cortical_regions, 6)

## Compare name columns as sanity check
#res_CP_MDD_brain_structure_regional_cortical_areas[c("regions_ggseg", "brain_phenotype")]

## Create informative groups
res_CP_MDD_brain_structure_regional_cortical_areas$group[(res_CP_MDD_brain_structure_regional_cortical_areas$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_areas$sample == "All")] <- "Chronic Pain: Full Sample"

res_CP_MDD_brain_structure_regional_cortical_areas$group[(res_CP_MDD_brain_structure_regional_cortical_areas$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_areas$sample == "Female")] <- "Chronic Pain: Female Sample"

res_CP_MDD_brain_structure_regional_cortical_areas$group[(res_CP_MDD_brain_structure_regional_cortical_areas$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_areas$sample == "Male")] <- "Chronic Pain: Male Sample"

res_CP_MDD_brain_structure_regional_cortical_areas$group[(res_CP_MDD_brain_structure_regional_cortical_areas$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_areas$sample == "All")] <- "Depression: Full Sample"

res_CP_MDD_brain_structure_regional_cortical_areas$group[(res_CP_MDD_brain_structure_regional_cortical_areas$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_areas$sample == "Female")] <- "Depression: Female Sample"

res_CP_MDD_brain_structure_regional_cortical_areas$group[(res_CP_MDD_brain_structure_regional_cortical_areas$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_areas$sample == "Male")] <- "Depression: Male Sample"


regional_cortical_areas_ggseg <- tibble(
  region = res_CP_MDD_brain_structure_regional_cortical_areas$regions_ggseg, 
  "Standardized β" = res_CP_MDD_brain_structure_regional_cortical_areas$beta,
  groups = res_CP_MDD_brain_structure_regional_cortical_areas$group
)

## Order groups
regional_cortical_areas_ggseg$groups <- ordered(regional_cortical_areas_ggseg$groups, levels = c("Chronic Pain: Full Sample", "Chronic Pain: Female Sample", "Chronic Pain: Male Sample", "Depression: Full Sample", "Depression: Female Sample", "Depression: Male Sample"))


regional_cortical_areas_ggseg %>%
  group_by(groups) %>%
  ggplot() +
  geom_brain(atlas = dk, 
             hemi = "right",
             aes(fill = `Standardized β`)) +
  facet_wrap(~groups) +
  scale_fill_gradient2(low = 'blue', mid = 'white', high = 'red') +
  theme_minimal() 

```


##### Cortex thickness map


```{r Cortex thickness chronic pain status, echo = FALSE}

## Get only regional cortical thickness in chronic pain 
res_CP_MDD_brain_structure_regional_cortical_thickness <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$brain_structure_type == "Cortical_Regional Thickness") & (res_CP_MDD_brain_structure$disorder == "chronic_pain" | res_CP_MDD_brain_structure$disorder == "recurrent_depression"),]

dk_cortical_regions <- dk$palette

## Remove "corpus callosum" and "temporal pole" as they are not availalbe on UKB
dk_cortical_regions <- names(dk_cortical_regions)[!names(dk_cortical_regions) %in% c("corpus callosum", "temporal pole")]
res_CP_MDD_brain_structure_regional_cortical_thickness$regions_ggseg <- rep(dk_cortical_regions, 6)

## Compare name columns as sanity check
#res_CP_MDD_brain_structure_regional_cortical_thickness[c("regions_ggseg", "brain_phenotype")]

## Create informative groups
res_CP_MDD_brain_structure_regional_cortical_thickness$group[(res_CP_MDD_brain_structure_regional_cortical_thickness$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_thickness$sample == "All")] <- "Chronic Pain: Full Sample"

res_CP_MDD_brain_structure_regional_cortical_thickness$group[(res_CP_MDD_brain_structure_regional_cortical_thickness$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_thickness$sample == "Female")] <- "Chronic Pain: Female Sample"

res_CP_MDD_brain_structure_regional_cortical_thickness$group[(res_CP_MDD_brain_structure_regional_cortical_thickness$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_cortical_thickness$sample == "Male")] <- "Chronic Pain: Male Sample"

res_CP_MDD_brain_structure_regional_cortical_thickness$group[(res_CP_MDD_brain_structure_regional_cortical_thickness$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_thickness$sample == "All")] <- "Depression: Full Sample"

res_CP_MDD_brain_structure_regional_cortical_thickness$group[(res_CP_MDD_brain_structure_regional_cortical_thickness$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_thickness$sample == "Female")] <- "Depression: Female Sample"

res_CP_MDD_brain_structure_regional_cortical_thickness$group[(res_CP_MDD_brain_structure_regional_cortical_thickness$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_cortical_thickness$sample == "Male")] <- "Depression: Male Sample"

regional_cortical_thickness_ggseg <- tibble(
  region = res_CP_MDD_brain_structure_regional_cortical_thickness$regions_ggseg, 
  "Standardized β" = res_CP_MDD_brain_structure_regional_cortical_thickness$beta,
  groups = res_CP_MDD_brain_structure_regional_cortical_thickness$group
)

## Order groups
regional_cortical_thickness_ggseg$groups <- ordered(regional_cortical_thickness_ggseg$groups, levels = c("Chronic Pain: Full Sample", "Chronic Pain: Female Sample", "Chronic Pain: Male Sample", "Depression: Full Sample", "Depression: Female Sample", "Depression: Male Sample"))

## Only display one hemisphere ase resutls are unilateral
regional_cortical_thickness_ggseg %>%
  group_by(groups) %>%
  ggplot() +
  geom_brain(atlas = dk, 
             hemi = "right",
             aes(fill = `Standardized β`)) +
  facet_wrap(~groups) +
  scale_fill_gradient2(low = 'blue', mid = 'white', high = 'red') +
  theme_minimal()


```

##### Subcortex volume map 

```{r subcortical volume map, echo = FALSE, warning=FALSE}

## Get only regional sub cortical volume
res_CP_MDD_brain_structure_regional_subcortical_volume <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$brain_structure_type == "Subcortical_Volumes") & (res_CP_MDD_brain_structure$disorder == "chronic_pain" | res_CP_MDD_brain_structure$disorder == "recurrent_depression"),]

sub_cortical_regions <- c("thalamus proper","caudate", "putamen", "pallidum", "hippocampus", "amygdala", "accumbens area")

res_CP_MDD_brain_structure_regional_subcortical_volume$regions_ggseg <- sub_cortical_regions

## Compare name columns as sanity check
#res_CP_MDD_brain_structure_regional_subcortical_volume[c("regions_ggseg", "brain_phenotype")]

## Create informative groups
res_CP_MDD_brain_structure_regional_subcortical_volume$group[(res_CP_MDD_brain_structure_regional_subcortical_volume$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_subcortical_volume$sample == "All")] <- "Chronic Pain: Full Sample"

res_CP_MDD_brain_structure_regional_subcortical_volume$group[(res_CP_MDD_brain_structure_regional_subcortical_volume$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_subcortical_volume$sample == "Female")] <- "Chronic Pain: Female Sample"

res_CP_MDD_brain_structure_regional_subcortical_volume$group[(res_CP_MDD_brain_structure_regional_subcortical_volume$disorder == "chronic_pain") & (res_CP_MDD_brain_structure_regional_subcortical_volume$sample == "Male")] <- "Chronic Pain: Male Sample"

res_CP_MDD_brain_structure_regional_subcortical_volume$group[(res_CP_MDD_brain_structure_regional_subcortical_volume$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_subcortical_volume$sample == "All")] <- "Depression: Full Sample"

res_CP_MDD_brain_structure_regional_subcortical_volume$group[(res_CP_MDD_brain_structure_regional_subcortical_volume$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_subcortical_volume$sample == "Female")] <- "Depression: Female Sample"

res_CP_MDD_brain_structure_regional_subcortical_volume$group[(res_CP_MDD_brain_structure_regional_subcortical_volume$disorder == "recurrent_depression") & (res_CP_MDD_brain_structure_regional_subcortical_volume$sample == "Male")] <- "Depression: Male Sample"


regional_subcortical_volume_ggseg <- tibble(
  region = res_CP_MDD_brain_structure_regional_subcortical_volume$regions_ggseg, 
  "Standardized β" = res_CP_MDD_brain_structure_regional_subcortical_volume$beta,
  groups = res_CP_MDD_brain_structure_regional_subcortical_volume$group
)


## Order groups
regional_subcortical_volume_ggseg$groups <- ordered(regional_subcortical_volume_ggseg$groups, levels = c("Chronic Pain: Full Sample", "Chronic Pain: Female Sample", "Chronic Pain: Male Sample", "Depression: Full Sample", "Depression: Female Sample", "Depression: Male Sample"))

ggplot() +
  geom_brain(atlas = aseg,
             hemi = "right") +
  scale_fill_brain2(wes_palette("Darjeeling1",8,type = "continuous")) +
  theme_minimal()


regional_subcortical_volume_ggseg %>%
  group_by(groups) %>%
  ggplot() +
  geom_brain(atlas = aseg,
             aes(fill = `Standardized β`),
             hemi = "left") +
  facet_wrap(~groups) +
  scale_fill_gradient2(low = 'blue', mid = 'white', high = 'red') +
  theme_minimal()


```

![](../output/plots/individual/p1.png)![](../output/plots/individual/p1.png) 


##### DTI: MD map
```{r DTI:  heatmap, include=FALSE}

## Get only indidual MD tract measures
res_CP_MDD_brain_structure_regional_MD <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$brain_structure_type == "MD_Tracts") & (res_CP_MDD_brain_structure$disorder == "chronic_pain" | res_CP_MDD_brain_structure$disorder == "recurrent_depression"),]

## Get only individual FA tract measures
res_CP_MDD_brain_structure_regional_FA <- res_CP_MDD_brain_structure[(res_CP_MDD_brain_structure$brain_structure_type == "FA_Tracts") & (res_CP_MDD_brain_structure$disorder == "chronic_pain" | res_CP_MDD_brain_structure$disorder == "recurrent_depression"),]



## Get HEX colour to represent Beta scores of each tract in each sample
## Get heatmap of MD and FA measures for individual DTI tracts
p1 <- ggplot(res_CP_MDD_brain_structure_regional_MD, aes(x =brain_phenotype, y = sample, fill = beta)) +
  geom_tile() +
  scale_fill_gradient2(low = 'blue', mid = 'white', high = 'red') +
  facet_grid(. ~ disorder)

p2 <- ggplot(res_CP_MDD_brain_structure_regional_FA, aes(x =brain_phenotype, y = sample, fill = beta)) +
  geom_tile() +
  scale_fill_gradient2(low = 'blue', mid = 'white', high = 'red')+
  facet_grid(. ~ disorder)


# get plot build
build <- ggplot_build(p1)
# select hex value and x-value data
hex_df <- build$data[[1]][, c("fill", "PANEL", "y", "x")]
# order hex value data
hex_df_ordered_1 <- hex_df[with(hex_df, order(PANEL, y, x)), ]

## Add tract, sample and disorder name
hex_df_ordered_1$tract <- sort(unique(res_CP_MDD_brain_structure_regional_MD$brain_phenotype))
hex_df_ordered_1$sample <- c(rep("All", 15), rep("Female",15), rep("Male", 15))
hex_df_ordered_1$disorder <- c(rep("CP", 45), rep("MDD", 45))

# get plot build
build <- ggplot_build(p2)
# select hex value and x-value data
hex_df <- build$data[[1]][, c("fill", "PANEL", "y", "x")]
# order hex value data
hex_df_ordered_2 <- hex_df[with(hex_df, order(PANEL, y, x)), ]

## Add tract, sample and disorder name
hex_df_ordered_2$tract <- sort(unique(res_CP_MDD_brain_structure_regional_FA$brain_phenotype))
hex_df_ordered_2$sample <- c(rep("All", 15), rep("Female",15), rep("Male", 15))
hex_df_ordered_2$disorder <- c(rep("CP", 45), rep("MDD", 45))

```

![](../writeup/DTI_results_visualise_MD.jpg)

##### DTI: FA map

![](../writeup/DTI_results_visualise_FA.jpg)





