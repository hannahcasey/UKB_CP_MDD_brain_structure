---
title: "Brain Structure in Chronic Pain and Depression Supplementary Material"
output: 
  word_document:
    reference_docx: ../writeup/RMD_template.docx
---

```{r setup, include=FALSE}
library(kableExtra)
library(dplyr)
library(flextable)
library(stringr)
library(tidyr)
```

# Table of contents:\

## 1. Supplementary Methods
### 1.1. Neurological disorders excluded
### 1.2. Brain structures full details
### 1.3. Sensitivity analysis in sex balanced datasets

## 2. Supplementary Results
### 2.1. Full results from main analysis
### 2.2. Results from sensitivity analysis in balanced datasets

\newpage
# 1. Supplementary Methods

\n

\n

## 1.1. Neurological disorders excluded

Neurological disorder status was determined based on self-reported illnesses recorded in UK Biobank data fields 20001 and 20002. 

```{r Neurological, echo=F}

UKB_neurological <- data.frame(Disorder = c("Benign neuroma", "Brain abscess/intracranial abscess", "Brain haemorrhage", "Cerebral aneurysm", "Cerebral palsy", "Chronic/degenerative neurological problem", "dementia/alzheimers/cognitive impairment", "Encephalitis", "Epilepsy", "Fracture skull/head", "Head injury", "Ischaemic stroke", "Meningitis", "Motor Neurone Disease", "Multiple Sclerosis", "Nervous system infection", "Neurological injury/trauma", "Other demyelinating disease (not Multiple Sclerosis)", "Other neurological problem", "Parkinson’s Disease", "Spina Bifida", "Stroke", "Subarachnoid haemorrhage", "Subdural haemorrhage/haematoma", "Transient ischaemic attack", "Meningioma/benign meningeal tumour"), `Data field` = c("1683", 1245, 1491, 1425, 1433, 1258, 1263, 1246, 1264, 1626, 1266, 1583, 1247, 1259, 1261, 1244, 1240, 1397, 1434, 1262, 1524, 1081, 1086, 1083, 1082, 1659))

UKB_neurological_cancer <- data.frame(Disorder = c("Brain cancer/primary malignant brain tumour", "Meningeal cancer/malignant meningioma"), `Data field` = c("1032", 1031))

flextable(UKB_neurological) %>%
  autofit() %>%
  fit_to_width(7) %>%
  theme_booktabs()
  
```
Table S1.1.1 Non-cancer neurological conditions excluded for based on data field 20002.

\newpage


```{r Neurological cancer, echo=F}
flextable(UKB_neurological_cancer) %>%
  autofit() %>%
  fit_to_width(7)
```
Table S1.1.2 Cancer neurological conditions excluded for based on data field 20001.

\newpage
## 1.2. Brain structures full details

Measures of cortical volume, thickness and surface area in UK Biobank
```{r Cortical measures, echo=F, warning=F}
frontal_lobe <- c("superior frontal gyrus" , "rostral middle frontal", "caudal middle frontal", "pars orbitalis", "pars triangularis", "pars opercularis", "frontal pole", "lateral orbitofrontal", "precentral gyrus", "paracentral cortex")
temporal_lobe <- c("insula", "superior temporal", "transverse temporal", "banks STS", "middle temporal gyrus" , "iferior temporal gyrus" , "fusiform" , "parahippocampal" , "entorhinal")
parietal_lobe <- c("postcentral gyrus", "paracentral cortex", "superior parietal cortex", "inferior parietal cortex", "supramarginal gyrus", "precuneus")
occipital_lobe <- c("lateral occipital cortex", "cuneus" , "pericalcarine cortex" , "lingual gyrus")
cingulate_lobe <- c("rostral ACC", "caudal ACC", "posterior cingulate cortex", "cingulate isthmus")

cortical_measures <- data_frame(`Cortical Region` = c(frontal_lobe, temporal_lobe, parietal_lobe, occipital_lobe, cingulate_lobe), `Lobe` = c(rep("frontal", length(frontal_lobe)), rep("temporal", length(temporal_lobe)), rep("parietal", length(parietal_lobe)), rep("occipital", length(occipital_lobe)), rep("cingulate", length(cingulate_lobe))))

flextable(cortical_measures) %>%
  autofit() %>%
  fit_to_width(7) 
```
Table S1.2.1 Cortical regions in UK Biobank and cortical lobes derived from “Desikan-Killiany-Tourville” atlas

\newpage

```{r subcortical measures, echo=F,  warning=F}

subcortical_volumes <- data_frame(`Subcortical Region` = c("thalamus", "caudate", "putamen", "pallidum", "hippocampus", "amygdala", "accumbens"))

flextable(subcortical_volumes) %>%
  autofit() %>%
  fit_to_width(7) 
```
Table S1.2.2 Subcortical volumes in UK Biobank derived using FIRST (FMRIB’s Integrated Registration and Segmentation Tool)

\newpage

```{r WM measures, echo=F,  warning=F}

association_fibres <- c("cingulate gyrus part of cingulum" , "inferior fronto-occipital fasciculus", "inferior longitudinal fasciculus", "parahippocampal part of cingulum", "superior longitudinal fasciculus", "uncinate fasciculus", "forceps major", "forceps minor")

thalamic_radiations <- c("anterior thalamic radiation", "posterior thalamic radiation", "superior thalamic radiation")

projection_fibres <- c("acoustic radiation", "corticospinal tract", "medial lemniscus" , "middle cerebellar peduncle")


WM_measures <- data_frame(`White Matter Tract` = c(association_fibres, thalamic_radiations, projection_fibres), `General Measure` = c(rep("association fibre", length(association_fibres)), rep("thalamic radiations", length(thalamic_radiations)), rep("projection fibres", length(projection_fibres))))

flextable(WM_measures) %>%
  autofit() %>%
  fit_to_width(7) 

```

Table S1.2.3 White matter tracts in UK Biobank and general measures derived using AutoPtx.

\newpage
## 1.3. Sensitivity analysis in sex balanced datasets

Sensitivity analysis was carried out in sex-balanced datasets. In order to ensure the same number of male and female cases and controls in sex-stratified association analysis we randomly removed males/female cases/cotrols where necessary. This was achieved using the `sample` function in R. The resulted in sex-balanced datasets. Full code is publically available on github: https://github.com/hannahcasey/UKB_CP_MDD_brain_structure

\newpage

## 2. Supplementary Results

\n

\n

### 2.1. Full results from main analysis

```{r All results, echo=F, warning=F}
# Read in results 
res_CP_MDD_brain_structure_all <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc.csv",header=T)
res_CP_MDD_brain_structure_all$sample <- "All"

res_CP_MDD_brain_structure_female <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc_females.csv",header=T)
res_CP_MDD_brain_structure_female$sample <- "Female"

res_CP_MDD_brain_structure_male <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_CP_MDD_structure_assoc_males.csv",header=T)
res_CP_MDD_brain_structure_male$sample <- "Male"

res_comorbidity_brain_structure_all <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_comorbidity_structure_assoc.csv")
res_comorbidity_brain_structure_all$sample <- "All"

res_comorbidity_brain_structure_female <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_comorbidity_structure_assoc_females.csv")
res_comorbidity_brain_structure_female$sample <- "Female"

res_comorbidity_brain_structure_male <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/all_comorbidity_structure_assoc_males.csv")
res_comorbidity_brain_structure_male$sample <- "Male"

## Combine results into single dataframes
res_CP_MDD_brain_structure <- rbind(res_CP_MDD_brain_structure_all, res_CP_MDD_brain_structure_female, res_CP_MDD_brain_structure_male)

res_comorbidity_brain_structure <- rbind(res_comorbidity_brain_structure_all, res_comorbidity_brain_structure_female, res_comorbidity_brain_structure_male)

## Create new columns to reformat brain phenotypes for plotting
res_CP_MDD_brain_structure$brain_phenotype_plot <-  gsub("MD", "MD in", res_CP_MDD_brain_structure$brain_phenotype)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("FA", "FA in", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("volume", "Volume of", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("area", "Area of", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_CP_MDD_brain_structure$brain_phenotype_plot)
res_CP_MDD_brain_structure$brain_phenotype_plot <- gsub("_|[.]", " ", res_CP_MDD_brain_structure$brain_phenotype_plot)

res_comorbidity_brain_structure$brain_phenotype_plot <-  gsub("MD", "MD in", res_comorbidity_brain_structure$brain_phenotype)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("FA", "FA in", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("volume", "Volume of", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("area", "Area of", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <- gsub("\\.[1-9]", "", res_comorbidity_brain_structure$brain_phenotype_plot)
res_comorbidity_brain_structure$brain_phenotype_plot <-  gsub("_|[.]", " ", res_comorbidity_brain_structure$brain_phenotype_plot)


## Reorder brain phenotype and subgroups for plotting
res_CP_MDD_brain_structure$brain_structure_type  <- ordered(res_CP_MDD_brain_structure$brain_structure_type , levels = c("Subcortical Volumes", "Cortical Regional Volumes","Cortical Volume Global and Lobal Measures", "Cortical Regional Areas", "Cortical Area Global and Lobal Measures", "Cortical Regional Thickness","Cortical Thickness Global and Lobal Measures", "FA Tracts", "MD Tracts","FA General Measures", "MD General Measures"))

res_comorbidity_brain_structure$brain_structure_type  <- ordered(res_comorbidity_brain_structure$brain_structure_type , levels = c("Subcortical Volumes", "Cortical Regional Volumes","Cortical Volume Global and Lobal Measures", "Cortical Regional Areas", "Cortical Area Global and Lobal Measures", "Cortical Regional Thickness","Cortical Thickness Global and Lobal Measures", "FA Tracts", "MD Tracts","FA General Measures", "MD General Measures"))


## Keep brain structure, beta, SD, P, adjusted P, CIs, disorder and sample
res_CP_MDD_brain_structure <- res_CP_MDD_brain_structure %>%
  select(brain_phenotype_plot, beta, std, p.value, p.adjust, Lower_95CI, Upper_95CI, n, disorder, sample) %>%
  rename(brain_phenotype = brain_phenotype_plot)

res_comorbidity_brain_structure <- res_comorbidity_brain_structure %>%
  select(brain_phenotype_plot, beta, std, p.value, p.adjust, Lower_95CI, Upper_95CI, n, disorder, sample) %>%
  rename(brain_phenotype = brain_phenotype_plot)

res_CP_MDD_brain_structure_CP <- res_CP_MDD_brain_structure[res_CP_MDD_brain_structure$disorder == "chronic_pain",]
res_CP_MDD_brain_structure_MDD <- res_CP_MDD_brain_structure[res_CP_MDD_brain_structure$disorder == "recurrent_depression",]

```


```{r chronic pain results, echo=F, warning=F}

flextable(res_CP_MDD_brain_structure_CP) %>%
  autofit() %>%
  fit_to_width(7) 

```
Table S2.1.1 Full results for association between brain structure and chronic pain in full, female and male sample
\newpage

```{r depression results, echo=F, warning=F}

flextable(res_CP_MDD_brain_structure_MDD) %>%
  autofit() %>%
  fit_to_width(7) 

```
Table S2.1.2 Full results for association between brain structure and depression in full, female and male sample
\newpage

```{r CPMDD results, echo=F, warning=F}

flextable(res_comorbidity_brain_structure) %>%
  autofit() %>%
  fit_to_width(7) 

```
Table S2.1.3 Full results for association between brain structure and comorbidity groups in full, female and male sample
\newpage

### 2.2. Results from sensitivity analysis in balanced datasets

```{r All results balanced, echo=F, warning=F}
# Read in results 
res_CP_MDD_brain_structure_female_balanced <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/balanced_all_CP_MDD_structure_assoc_females.csv",header=T)
res_CP_MDD_brain_structure_female_balanced $sample <- "Female"

res_CP_MDD_brain_structure_male_balanced  <- read.csv("/Users/hannahcasey/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/balanced_all_CP_MDD_structure_assoc_males.csv",header=T)
res_CP_MDD_brain_structure_male_balanced $sample <- "Male"


res_comorbidity_brain_structure_female_balanced <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/balanced_all_comorbidity_structure_assoc_females.csv")
res_comorbidity_brain_structure_female_balanced$sample <- "Female"
## Reverse direction of beta value
res_comorbidity_brain_structure_female_balanced$beta <- (res_comorbidity_brain_structure_female_balanced$beta  * -1)
res_comorbidity_brain_structure_female_balanced$Lower_95CI <- (res_comorbidity_brain_structure_female_balanced$Lower_95CI  * -1)
res_comorbidity_brain_structure_female_balanced$Upper_95CI <- (res_comorbidity_brain_structure_female_balanced$Upper_95CI  * -1)

res_comorbidity_brain_structure_male_balanced <- read.csv("~/Desktop/PhD/projects/UKB_CP_MDD_brain_structure/output/balanced_all_comorbidity_structure_assoc_males.csv")
res_comorbidity_brain_structure_male_balanced$sample <- "Male"
## Reverse direction of beta value
res_comorbidity_brain_structure_male_balanced$beta <- (res_comorbidity_brain_structure_male_balanced$beta  * -1)
res_comorbidity_brain_structure_male_balanced$Lower_95CI <- (res_comorbidity_brain_structure_male_balanced$Lower_95CI  * -1)
res_comorbidity_brain_structure_male_balanced$Upper_95CI <- (res_comorbidity_brain_structure_male_balanced$Upper_95CI  * -1)


## Combine results into single dataframes
res_CP_MDD_brain_structure_balanced <- rbind(res_CP_MDD_brain_structure_female_balanced, res_CP_MDD_brain_structure_male_balanced)

res_comorbidity_brain_structure_balanced<- rbind(res_comorbidity_brain_structure_female_balanced, res_comorbidity_brain_structure_male_balanced)

## Create new columns to reformat brain phenotypes for plotting
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <-  gsub("MD", "MD in", res_CP_MDD_brain_structure_balanced$brain_phenotype)
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <- gsub("FA", "FA in", res_CP_MDD_brain_structure_balanced$brain_phenotype_plot)
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <- gsub("volume", "Volume of", res_CP_MDD_brain_structure_balanced$brain_phenotype_plot)
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <- gsub("area", "Area of", res_CP_MDD_brain_structure_balanced$brain_phenotype_plot)
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_CP_MDD_brain_structure_balanced$brain_phenotype_plot)
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_CP_MDD_brain_structure_balanced$brain_phenotype_plot)
res_CP_MDD_brain_structure_balanced$brain_phenotype_plot <- gsub("_|[.]", " ", res_CP_MDD_brain_structure_balanced$brain_phenotype_plot)

res_comorbidity_brain_structure_balanced$brain_phenotype_plot <-  gsub("MD", "MD in", res_comorbidity_brain_structure_balanced$brain_phenotype)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <- gsub("FA", "FA in", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <- gsub("volume", "Volume of", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <- gsub("area", "Area of", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <- gsub("thickness", "Thickness of", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <- gsub("sub_cortical_Volume", "Subcortical volume", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <- gsub("\\.[1-9]", "", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)
res_comorbidity_brain_structure_balanced$brain_phenotype_plot <-  gsub("_|[.]", " ", res_comorbidity_brain_structure_balanced$brain_phenotype_plot)


## Reorder brain phenotype and subgroups for plotting
res_CP_MDD_brain_structure_balanced$brain_structure_type  <- ordered(res_CP_MDD_brain_structure_balanced$brain_structure_type , levels = c("Subcortical Volumes", "Cortical Regional Volumes","Cortical Volume Global and Lobal Measures", "Cortical Regional Areas", "Cortical Area Global and Lobal Measures", "Cortical Regional Thickness","Cortical Thickness Global and Lobal Measures", "FA Tracts", "MD Tracts","FA General Measures", "MD General Measures"))

res_comorbidity_brain_structure_balanced$brain_structure_type  <- ordered(res_comorbidity_brain_structure_balanced$brain_structure_type , levels = c("Subcortical Volumes", "Cortical Regional Volumes","Cortical Volume Global and Lobal Measures", "Cortical Regional Areas", "Cortical Area Global and Lobal Measures", "Cortical Regional Thickness","Cortical Thickness Global and Lobal Measures", "FA Tracts", "MD Tracts","FA General Measures", "MD General Measures"))


## Keep brain structure, beta, SD, P, adjusted P, CIs, disorder and sample

res_CP_MDD_brain_structure_balanced <- res_CP_MDD_brain_structure_balanced %>%
  select(brain_phenotype_plot, beta, std, p.value, p.adjust, Lower_95CI, Upper_95CI, n, disorder, sample) %>%
  rename(brain_phenotype = brain_phenotype_plot)

res_comorbidity_brain_structure_balanced <- res_comorbidity_brain_structure_balanced %>%
  select(brain_phenotype_plot, beta, std, p.value, p.adjust, Lower_95CI, Upper_95CI, n, disorder, sample) %>%
  rename(brain_phenotype = brain_phenotype_plot)

res_CP_MDD_brain_structure_CP_balanced <- res_CP_MDD_brain_structure_balanced[res_CP_MDD_brain_structure_balanced$disorder == "chronic_pain",]
res_CP_MDD_brain_structure_MDD_balanced <- res_CP_MDD_brain_structure_balanced[res_CP_MDD_brain_structure_balanced$disorder == "recurrent_depression",]

```


```{r balanced chronic pain results, echo=F, warning=F}

flextable(res_CP_MDD_brain_structure_CP_balanced) %>%
  autofit() %>%
  fit_to_width(7) 

```

Table S2.2.1 Full results for association between brain structure and chronic pain in full, female and male sample in balanced datasets
\newpage

```{r balanced depression results, echo=F, warning=F}

flextable(res_CP_MDD_brain_structure_MDD_balanced) %>%
  autofit() %>%
  fit_to_width(7) 

```

Table S2.2.2 Full results for association between brain structure and depression in full, female and male sample in balanced datasets
\newpage
```{r balanced CPMDD results, echo=F, warning=F}

flextable(res_comorbidity_brain_structure_balanced) %>%
  autofit() %>%
  fit_to_width(7) 

```

Table S2.2.3 Full results for association between brain structure and comorbidity groups in full, female and male sample in balanced datasets
\newpage




